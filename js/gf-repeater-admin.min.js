function gfRepeater_editforms_getRepeaters(){var e,t,r=0,i=0,d=[],a=[];return jQuery(".gfield").each(function(){if(0==r)jQuery(this).has(".gf-repeater-start").length&&(i+=1,gfRepeater_debug&&console.log("Repeater #"+i+" - Start: "+jQuery(this).attr("id")),e=this.id,r=1);else{if(jQuery(this).has(".gf-repeater-start").length)return!1;jQuery(this).has(".gf-repeater-end").length?(gfRepeater_debug&&console.log("Repeater #"+i+" - End: "+jQuery(this).attr("id")),t=this.id,gfRepeater_repeaters[i]={startId:e,endId:t,childrenIds:a,children:d},d=[],a=[],r=0,e=null,t=null):(d.push(this),a.push(this.id),gfRepeater_debug&&console.log("Repeater #"+i+" - Child #"+d.length+" - Found: "+this.id))}}),0!==r?!1:!0}function gfRepeater_getId(e){return e.substr(6)}function gfRepeater_getField(e){var t=gfRepeater_getId(e);return GetFieldById(t)}function gfRepeater_getIndex(e){var t=!1,r=-1;return jQuery(".gfield").each(function(){return r+=1,this.id==e?(t=!0,!1):void 0}),t?r:!1}function gfRepeater_getRepeaterEndId(e){var t,r=!1;return jQuery(".gfield").each(function(){var i=gfRepeater_getField(this.id),d=gfRepeater_getId(this.id);r?"repeater-end"==i.type&&(t=this.id,r=!1):"repeater"==i.type&&d==e&&(r=!0)}),t?t:!1}function gfRepeater_isIndexInsideRepeater(e){var t=!1,r=!1,i=-1;return jQuery(".gfield").each(function(){i+=1;var d=gfRepeater_getField(this.id);t?("repeater-end"==d.type?(gfRepeater_debug&&console.log("Repeater End Index: "+i),t=!1):gfRepeater_debug&&console.log("Repeater Child Index: "+i),i==e&&(r=!0)):"repeater"==d.type&&(gfRepeater_debug&&console.log("Repeater Start Index: "+i),t=!0)}),t&&(r=!1),gfRepeater_debug&&console.log("Is the index "+e+" inside of a repeater? "+r),r}function gfRepeater_brokenRepeater(){var e=!1,t=!1,r=-1;return jQuery(".gfield").each(function(){r+=1;var i=gfRepeater_getField(this.id);if(e){if("repeater"==i.type)return alert("Nesting Repeaters is not supported!"),t=!0,!1;if("repeater-end"==i.type)e=!1;else{var d=gfRepeater_editforms_fieldCheck(i.type,r);if(!d)return t=!0,!1}}else if("repeater"==i.type)e=!0;else if("repeater-end"==i.type)return alert("One of your repeaters are missing their repeater start field!"),t=!0,!1}),!t&&e&&(alert("One of your repeaters are missing their repeater end field!"),t=!0),t}function gfRepeater_editforms_update(e){gfRepeater_editforms_getRepeaters()&&(e&&UpdateFormObject(),jQuery.each(gfRepeater_repeaters,function(t,r){var i=gfRepeater_getField(this.startId),d=[],a=[];jQuery.each(this.children,function(t,r){var i=gfRepeater_editforms_updateRequired(r,e),n=gfRepeater_getId(r.id);i&&a.push(n),d.push(n)}),i.repeaterRequiredChildren=a,i.repeaterChildren=d}))}function gfRepeater_editforms_updateRequired(e,t){var r=(gfRepeater_getId(e.id),gfRepeater_getField(e.id)),i=r.isRequired,d=r.repeaterField_isRequired,a=!1;return gfRepeater_debug&&console.log(e.id+" - Before Filter - isRequired:"+r.isRequired+" - repeaterField_isRequired:"+r.repeaterField_isRequired),i&&t&&(r.isRequired=!1,r.repeaterField_isRequired=!0,gfRepeater_debug&&console.log(e.id+" - Used Filter 1"),a=!0),!i&&t&&(r.repeaterField_isRequired=!1,gfRepeater_debug&&console.log(e.id+" - Used Filter 2")),d&&!t&&(jQuery(e).find(".gfield_required").html("*"),r.isRequired=!0,r.repeaterField_isRequired=!1,gfRepeater_debug&&console.log(e.id+" - Used Filter 3")),d||t||(jQuery(e).find(".gfield_required").html(""),r.isRequired=!1,gfRepeater_debug&&console.log(e.id+" - Used Filter 4")),gfRepeater_debug&&console.log(e.id+" - After Filter - isRequired:"+r.isRequired+" - repeaterField_isRequired:"+r.repeaterField_isRequired),a}function gfRepeater_editforms_fieldCheck(e,t){var r=["text","textarea","select","multiselect","number","checkbox","radio","hidden","html","section","name","date","time","phone","address","website","email","product","quanity","option","shipping","total"];if(gfRepeater_isIndexInsideRepeater(t)){if("repeater"==e)return alert("Nesting repeaters is not supported!"),!1;if("repeater-end"!==e&&-1==jQuery.inArray(e,r))return alert("Sorry, the "+e+" field is not supported by the Gravity Forms Repeater Add-On at this time. :("),!1}return!0}function gfRepeater_editforms_patch_SaveForm(){var e=SaveForm;SaveForm=function(t){return gfRepeater_brokenRepeater()?!1:(gfRepeater_editforms_update(!0),e.call(this,t))}}function gfRepeater_editforms_patch_StartAddField(){var e=StartAddField;StartAddField=function(t,r){var i=gfRepeater_editforms_fieldCheck(t,r);return i?e.call(this,t,r):void jQuery("#gform_adding_field_spinner").remove()}}function gfRepeater_editforms_patch_EndAddField(){var e=EndAddField;EndAddField=function(t,r,i){e.call(this,t,r,i),"repeater"==t.type&&StartAddField("repeater-end",i+1)}}function gfRepeater_editforms_patch_StartDeleteField(){var e=StartDeleteField;StartDeleteField=function(t){var r=jQuery(t)[0].id.split("_")[2],i=GetFieldById(r);return"repeater-end"==i.type?void alert("This field cannot be deleted directly. Please delete the repeater start field first."):void e.call(this,t)}}function gfRepeater_editforms_patch_EndDeleteField(){var e=EndDeleteField;EndDeleteField=function(t){var r=GetFieldById(t);if("repeater"==r.type)var i=gfRepeater_getRepeaterEndId(t);e.call(this,t),"repeater"==r.type&&i&&(i=gfRepeater_getId(i),DeleteField(i))}}function gfRepeater_editforms_patch_SortUpdate(){jQuery("#gform_fields").sortable({update:function(e,t){gfRepeater_brokenRepeater()&&jQuery("#gform_fields").sortable("cancel")}})}var gfRepeater_debug=!1,gfRepeater_repeaters={},gfRepeater_page=gf_repeater_js_admin_strings.page;jQuery(document).ready(function(e){"gf_edit_forms"==gfRepeater_page&&(gfRepeater_editforms_update(!1),jQuery("#add_fields input[type=button][data-type=repeater-end]").remove())}),jQuery(window).load(function(){"gf_edit_forms"==gfRepeater_page&&(gfRepeater_editforms_patch_SaveForm(),gfRepeater_editforms_patch_StartAddField(),gfRepeater_editforms_patch_EndAddField(),gfRepeater_editforms_patch_StartDeleteField(),gfRepeater_editforms_patch_EndDeleteField(),gfRepeater_editforms_patch_SortUpdate())}),gfRepeater_debug&&jQuery(window).keydown(function(e){38==e.which&&console.log(gfRepeater_repeaters),40==e.which&&jQuery(".gfield").each(function(){console.log(gfRepeater_getField(this.id))})});